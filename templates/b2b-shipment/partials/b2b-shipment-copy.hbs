<section class="challan-copy">
  <header class="copy-header">
    <div class="company-block">
      {{#if company.logo_data_url}}
      <img class="logo" src="{{company.logo_data_url}}" alt="Company Logo" />
      {{/if}}
      <div>
        <h1>{{safe company.name}}</h1>
        <p>{{safe company.address}}</p>
        <p>{{safe company.phone}} {{#if company.email}}| {{company.email}}{{/if}}</p>
        {{#if company.website}}<p>{{company.website}}</p>{{/if}}
      </div>
    </div>
    <div class="copy-meta">
      <div class="copy-label">{{copyLabel}}</div>
      <div class="meta-row"><span>Challan No</span><strong>{{safe shipment.shipment_no}}</strong></div>
      <div class="meta-row"><span>Date</span><strong>{{formatDate shipment.shipment_date}}</strong></div>
      <div class="meta-row"><span>Order No</span><strong>{{safe order.order_number}}</strong></div>
      <div class="meta-row"><span>Generated By</span><strong>{{safe generated_by}}</strong></div>
    </div>
  </header>

  <div class="grid">
    <article class="card">
      <h3>Warehouse</h3>
      <p><strong>{{safe warehouse.name}}</strong></p>
      <p>{{safe warehouse.address}}</p>
    </article>
    <article class="card">
      <h3>To (Customer)</h3>
      <p><strong>{{safe customer.name}}</strong></p>
      <p>{{safe customer.address}}</p>
      <p>{{safe customer.mobile}}</p>
    </article>
    <article class="card">
      <h3>Transport & Order</h3>
      <p><span>Transporter</span><strong>{{safe shipment.transporter}}</strong></p>
      <p><span>Vehicle</span><strong>{{safe shipment.vehicle_number}}</strong></p>
      <p><span>LR No</span><strong>{{safe shipment.lr_number}}</strong></p>
    </article>
  </div>

  <table class="items-table">
    <thead>
      <tr>
        <th>#</th>
        <th>HSN</th>
        <th>Product</th>
        <th>Description</th>
        <th class="num">Qty</th>
        <th>UOM</th>
      </tr>
    </thead>
    <tbody>
      {{#if items_grouped.length}}
        {{#each items_grouped}}
          <tr class="group-row">
            <td colspan="6">
              <span class="group-name">{{safe group_name}}</span>
              <span class="group-meta">({{group_qty}} Qty)</span>
            </td>
          </tr>
          {{#each items}}
          <tr>
            <td>{{index}}</td>
            <td>{{safe hsn}}</td>
            <td>{{safe product_name}}</td>
            <td>{{safe description}}</td>
            <td class="num">{{quantity}}</td>
            <td>{{safe uom}}</td>
          </tr>
          {{/each}}
        {{/each}}
      {{else}}
        {{#if items.length}}
          {{#each items}}
          <tr>
            <td>{{index}}</td>
            <td>{{safe hsn}}</td>
            <td>{{safe product_name}}</td>
            <td>{{safe description}}</td>
            <td class="num">{{quantity}}</td>
            <td>{{safe uom}}</td>
          </tr>
          {{/each}}
        {{else}}
          <tr>
            <td colspan="6" class="empty">No items available.</td>
          </tr>
        {{/if}}
      {{/if}}
    </tbody>
    <tfoot>
      <tr>
        <td colspan="4" class="total-label">Total Quantity</td>
        <td class="num">{{total_quantity}}</td>
        <td></td>
      </tr>
    </tfoot>
  </table>

  {{#if items_with_serials.length}}
  <div class="serial-numbers-section">
    <h4>Serial Numbers Captured</h4>
    {{#each items_with_serials}}
    <div class="serial-numbers-block">
      <div class="serial-header">
        <strong>{{safe product_name}}</strong> <span class="serial-qty">({{serial_numbers.length}})</span>
      </div>
      <ul class="serial-grid">
        {{#each serial_numbers}}
        <li>{{this}}</li>
        {{/each}}
      </ul>
    </div>
    {{/each}}
  </div>
  {{/if}}

  <div class="notes-signatures">
    <article class="note">
      <h4>Note</h4>
      <p>{{safe shipment.remarks}}</p>
      <p class="muted">Received material in good condition.</p>
    </article>
    <article class="sign">
      <h4>Receiver</h4>
      <p>Name: _______________________</p>
      <p>Mobile: ______________________</p>
      <p>Signature: ___________________</p>
    </article>
    <article class="sign">
      <h4>Authorized Signatory</h4>
      <p>Name: _______________________</p>
      <p>Designation: _________________</p>
      <p>Signature: ___________________</p>
    </article>
  </div>
</section>

{{#unless isLastCopy}}
<div class="page-break"></div>
{{/unless}}

